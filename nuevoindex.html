<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rotiser√≠a El Tachi</title>
  <link rel="icon" href="logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --azul:#003366;
      --azul-2:#001122;
      --azul-3:#004080;
      --amarillo:#ffcc00;
      --gris-borde:#ccc;
      --bg:#f8f9fa;
      --text:#333;
      --card:#fff;
      --card-hover:#f1f1f1;
      --resumen-bg:#fff3cd;
      --resumen-borde:#ffeeba;
      --ok:#16a34a;
      --error:#dc2626;
    }
    *{box-sizing:border-box}
    body {
      font-family: 'Roboto', sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
    }
    header {
      background: linear-gradient(90deg, var(--azul) 0%, var(--azul-2) 100%);
      color: #fff;
      padding: 2rem 1rem;
      text-align: center;
    }
    header img { max-height: 180px; margin: 0 auto 1rem; }

    /* Agregamos espacio para que nunca tape el FAB */
    main {
      padding: 1rem;
      max-width: 900px;
      margin: auto;
      padding-bottom: 112px; /* deja aire detr√°s del FAB */
    }

    /* Tabs */
    .tabs {
      display: flex; justify-content: center; margin-bottom: 1rem; gap: 1rem; flex-wrap: wrap;
    }
    .tabs button {
      padding: 0.8rem 1.8rem; font-size: 1.1rem; border: none;
      background: var(--azul-3); color: var(--amarillo); font-weight: bold;
      border-radius: 30px; box-shadow: 0 3px 8px rgba(0,0,0,0.2);
      cursor: pointer; transition: all 0.3s ease; border: 2px solid transparent;
    }
    .tabs button:hover { background: #0055aa; }
    .tabs button.active {
      background: var(--azul-2); border-color: var(--amarillo); box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    /* Acorde√≥n */
    details {
      border: 1px solid var(--gris-borde);
      border-radius: 8px;
      margin-bottom: 1rem;
      overflow: hidden;
      background: var(--card);
    }
    summary {
      background: var(--azul);
      color: var(--amarillo);
      padding: 1rem;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1rem;
      user-select: none;
      list-style: none;
    }

    /* Producto */
    .producto {
      display: flex; justify-content: space-between; align-items: center; gap: .75rem;
      padding: 0.5rem 1rem; border-top: 1px solid #ddd; background: var(--card);
      transition: background .2s ease;
    }
    .producto:hover { background: var(--card-hover); }
    .producto-info { max-width: 65%; }
    .producto h3 { margin: 0.2rem 0; color: #004c99; font-size: 1rem; }
    .producto p { margin: 0.1rem 0; font-size: 0.9rem; color: var(--text); }
    .contador { display: flex; align-items: center; gap: 0.5rem; }
    .contador button {
      background: var(--azul); color: var(--amarillo); border: none;
      padding: 0.3rem 0.6rem; font-weight: bold; font-size: 1.2rem;
      cursor: pointer; border-radius: 5px; transform-origin:center;
    }

    /* Animaciones */
    @keyframes pop { 0%{transform:scale(1)} 50%{transform:scale(1.2)} 100%{transform:scale(1)} }
    .btn-pop{ animation: pop .22s ease-out; }
    @keyframes flash { 0%{box-shadow:0 0 0 rgba(255,204,0,0)} 50%{box-shadow:0 0 0 4px rgba(255,204,0,.35)} 100%{box-shadow:0 0 0 rgba(255,204,0,0)} }
    .row-flash{ animation: flash .35s ease-out; }

    /* Resumen */
    #resumen {
      margin-top: 2rem; padding: 1rem; background: var(--resumen-bg);
      border: 1px solid var(--resumen-borde); border-radius: 8px;
    }
    #resumen .acciones {
      display:flex; gap:.75rem; flex-wrap:wrap;
    }
    #resumen button {
      background: var(--azul); color: var(--amarillo);
      border: none; padding: 0.8rem 1.2rem; margin-top: 1rem; cursor: pointer;
      font-weight: bold; font-size: 1rem; border-radius: 5px;
    }
    #btn-vaciar {
      background:#fff; color:#333; border:1px solid var(--gris-borde);
    }
    #btn-whatsapp:disabled{ opacity:.6; cursor:not-allowed; }

    label { display: block; margin-top: 1rem; }

    /* FAB Carrito (pastilla) */
    .cart-fab{
      position: fixed;
      right: 16px;
      bottom: calc(16px + env(safe-area-inset-bottom));
      z-index: 99;
      background: var(--azul);
      color: var(--amarillo);
      border: 2px solid var(--amarillo);
      display: flex; align-items: center; gap: .6rem;
      padding: .6rem .9rem;
      border-radius: 9999px;
      box-shadow: 0 8px 18px rgba(0,0,0,.25);
      cursor: pointer;
      transition: transform .15s ease;
    }
    .cart-fab:hover{ transform: translateY(-2px); }
    .cart-fab[hidden]{ display:none; }
    .cart-icon{ font-size: 1.1rem; }
    .cart-total{ font-weight: 700; }
    .cart-count{
      background: var(--amarillo); color: var(--azul-2);
      min-width: 26px; height: 26px; border-radius: 999px;
      display: grid; place-items: center; font-weight: 800;
    }
    @keyframes bump { 0%,100%{ transform: translateY(0) scale(1);} 50%{ transform: translateY(0) scale(1.08);} }
    .cart-fab.bump{ animation: bump .3s ease; }

    /* Levantamos M√ÅS cuando el footer aparece */
    .cart-fab.raise{ transform: translateY(-112px); }

    /* En m√≥vil, mantener pastilla (no volver al c√≠rculo) */
    @media (max-width:520px){
      .cart-fab{
        width:auto; height:auto;
        padding:.55rem .8rem; gap:.5rem;
      }
      .cart-icon{ display:inline; }
      .cart-total{ display:inline; font-size:.95rem; }
      .cart-count{ min-width:22px; height:22px; font-size:.85rem; }
    }

    /* Toasts */
    .toast-wrap{
      position:fixed; left:50%; bottom:84px; transform:translateX(-50%);
      z-index:100; display:flex; flex-direction:column; gap:.5rem; pointer-events:none;
    }
    .toast{
      pointer-events:auto;
      background:#0b1f3a; color:#fff; border-left:4px solid var(--azul-3);
      padding:.7rem 1rem; border-radius:8px; box-shadow:0 10px 24px rgba(0,0,0,.25);
      animation:fadeIn .18s ease-out;
      max-width: calc(100vw - 40px);
    }
    .toast.ok{ border-left-color: var(--ok); }
    .toast.err{ border-left-color: var(--error); }
    @keyframes fadeIn{ from{opacity:0; transform:translate(-50%,10px)} to{opacity:1; transform:translate(-50%,0)} }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Rotiser√≠a El Tachi" />
    <h1>Rotiser√≠a El Tachi</h1>
    <p>¬°Hac√© tu pedido desde la web!</p>
  </header>

  <main>
    <div class="tabs">
      <button id="btn-rotiseria" class="active" onclick="mostrar('rotiseria')">üçï Rotiser√≠a</button>
      <button id="btn-almacen" onclick="mostrar('almacen')">üõçÔ∏è Almac√©n</button>
    </div>

    <div id="menu-rotiseria"></div>
    <div id="menu-almacen" style="display:none"></div>

    <label><input type="radio" name="envio" value="retiro" checked> Retiro en el local</label>
    <label><input type="radio" name="envio" value="envio"> Env√≠o a domicilio (+$1000)</label>
    <label>Nombre: <input type="text" id="nombre" /></label>
    <label>Direcci√≥n: <input type="text" id="direccion" /></label>

    <div id="resumen">
      <h3>Resumen del pedido</h3>
      <ul id="lista"></ul>
      <p><strong>Total: <span id="total">$ 0</span></strong></p>
      <div class="acciones">
        <button id="btn-whatsapp" onclick="enviarPedido()">Hacer pedido por WhatsApp</button>
        <button id="btn-vaciar" type="button" onclick="vaciarCarrito()">Vaciar carrito</button>
      </div>
    </div>
  </main>

  <!-- FAB Carrito -->
  <div id="cartFab" class="cart-fab" hidden title="Ver pedido" aria-live="polite" aria-label="Ver pedido">
    <span class="cart-icon">üõí</span>
    <span class="cart-total" id="fabTotal">$ 0</span>
    <span class="cart-count" id="fabCount">0</span>
  </div>

  <!-- Toast container -->
  <div id="toastWrap" class="toast-wrap"></div>

  <script>
    /* ---------- Utilidades ---------- */
    const CART_KEY = 'tachi_cart_v1';
    const formatARS = new Intl.NumberFormat('es-AR',{ style:'currency', currency:'ARS', maximumFractionDigits:0 }).format;

    function asset(path) {
      const host = location.hostname;
      if (host.endsWith('github.io')) {
        const parts = location.pathname.split('/').filter(Boolean);
        const repo = parts[0] || '';
        return `/${repo}/${path}`;
      }
      return `/${path}`;
    }
    function normalizar(data) {
      if (data && Array.isArray(data.categorias)) {
        const o = {};
        data.categorias.forEach(c => { o[c.categoria] = c.productos || []; });
        return o;
      }
      return data || {};
    }
    function showToast(msg, type='ok', timeout=2200){
      const wrap = document.getElementById('toastWrap');
      const el = document.createElement('div');
      el.className = `toast ${type==='error'?'err':type==='ok'?'ok':''}`;
      el.textContent = msg;
      wrap.appendChild(el);
      setTimeout(()=> { el.style.opacity='0'; el.style.transition='opacity .2s'; }, timeout);
      setTimeout(()=> wrap.removeChild(el), timeout+220);
    }

    /* ---------- Estado ---------- */
    const cantidades = {};
    const listaEl = document.getElementById('lista');
    const totalEl = document.getElementById('total');
    const btnWA = document.getElementById('btn-whatsapp');

    // FAB elements
    const fab = document.getElementById('cartFab');
    const fabCount = document.getElementById('fabCount');
    const fabTotal = document.getElementById('fabTotal');

    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cantidades)); }
    function loadCart(){
      try { return JSON.parse(localStorage.getItem(CART_KEY) || '{}'); }
      catch { return {}; }
    }

    /* ---------- Render ---------- */
    function renderProductos(contenedorId, productos) {
      const contenedor = document.getElementById(contenedorId);
      contenedor.innerHTML = '';
      const data = normalizar(productos);

      for (let categoria in data) {
        const items = data[categoria] || [];

        const detail = document.createElement('details');
        const summary = document.createElement('summary');
        summary.textContent = categoria;
        detail.appendChild(summary);

        items.forEach((prod, i) => {
          const id = `${contenedorId}-${categoria}-${i}`;
          if (!(id in cantidades)) cantidades[id] = 0;

          const div = document.createElement('div');
          div.className = 'producto';
          div.innerHTML = `
            <div class="producto-info">
              <h3>${prod.nombre} - ${formatARS(prod.precio)}</h3>
              ${prod.desc ? `<p>${prod.desc}</p>` : ""}
            </div>
            <div class="contador">
              <button onclick="cambiarCantidad('${id}', -1, this)">‚àí</button>
              <span id="cantidad-${id}">0</span>
              <button onclick="cambiarCantidad('${id}', 1, this)">+</button>
            </div>
          `;
          div.dataset.nombre = prod.nombre;
          div.dataset.precio = prod.precio;
          detail.appendChild(div);
        });

        contenedor.appendChild(detail);
      }
    }

    function cargarProductos() {
      const p1 = fetch(asset('data/productos-rotiseria.json'))
        .then(res => res.json())
        .then(data => renderProductos('menu-rotiseria', data))
        .catch(() => showToast('Error cargando Rotiser√≠a', 'error'));

      const p2 = fetch(asset('data/productos-almacen.json'))
        .then(res => res.json())
        .then(data => renderProductos('menu-almacen', data))
        .catch(() => showToast('Error cargando Almac√©n', 'error'));

      Promise.allSettled([p1, p2]).then(hydrateFromStorage);
    }
    cargarProductos();

    function hydrateFromStorage(){
      const persisted = loadCart();
      let hadItems = false;
      Object.entries(persisted).forEach(([id, qty])=>{
        if (qty > 0) {
          cantidades[id] = qty;
          const el = document.getElementById(`cantidad-${id}`);
          if (el) { el.textContent = qty; hadItems = true; }
        }
      });
      if (hadItems) actualizarResumen();
    }

    /* ---------- Carrito + Animaciones ---------- */
    function cambiarCantidad(id, delta, btn) {
      cantidades[id] = Math.max(0, (cantidades[id] || 0) + delta);
      const el = document.getElementById(`cantidad-${id}`);
      if (el) el.textContent = cantidades[id];

      if (delta > 0 && btn) {
        btn.classList.add('btn-pop');
        btn.addEventListener('animationend', () => btn.classList.remove('btn-pop'), { once: true });
        const row = btn.closest('.producto');
        row.classList.add('row-flash');
        row.addEventListener('animationend', () => row.classList.remove('row-flash'), { once: true });

        // bump en FAB
        fab.classList.add('bump');
        fab.addEventListener('animationend', ()=> fab.classList.remove('bump'), { once:true });
      }

      saveCart();
      actualizarResumen();
    }

    function countItems(){
      return Object.values(cantidades).reduce((a,b)=> a+(b||0), 0);
    }

    function actualizarResumen() {
      listaEl.innerHTML = '';
      let total = 0;
      let count = 0;

      for (let id in cantidades) {
        const cantidad = cantidades[id];
        if (cantidad > 0) {
          const span = document.getElementById(`cantidad-${id}`);
          if (!span) continue;
          const productoDiv = span.closest('.producto');
          const nombre = productoDiv?.dataset?.nombre || '';
          const precio = parseInt(productoDiv?.dataset?.precio || '0', 10);

          const li = document.createElement('li');
          li.textContent = `${nombre} x${cantidad} - ${formatARS(precio * cantidad)}`;
          listaEl.appendChild(li);

          total += precio * cantidad;
          count += cantidad;
        }
      }

      const envio = document.querySelector('input[name=envio]:checked').value;
      if (envio === 'envio') total += 1000;

      totalEl.textContent = formatARS(total);

      // FAB
      fabCount.textContent = count;
      fabTotal.textContent = formatARS(total);
      fab.hidden = count === 0;

      // habilitar/deshabilitar bot√≥n WhatsApp
      const nombreOk = document.getElementById('nombre').value.trim().length > 0;
      btnWA.disabled = !(count > 0 && nombreOk);
    }

    document.getElementById('nombre').addEventListener('input', actualizarResumen);
    document.querySelectorAll('input[name=envio]').forEach(r => r.addEventListener('change', actualizarResumen));

    // click en FAB: ir al resumen
    fab.addEventListener('click', () => {
      document.getElementById('resumen').scrollIntoView({ behavior: 'smooth' });
    });

    function vaciarCarrito(){
      Object.keys(cantidades).forEach(k => cantidades[k]=0);
      document.querySelectorAll('[id^="cantidad-"]').forEach(span => span.textContent='0');
      saveCart();
      actualizarResumen();
      showToast('Carrito vac√≠o');
    }

    /* ---------- Tabs ---------- */
    function mostrar(seccion) {
      document.getElementById('menu-rotiseria').style.display = seccion === 'rotiseria' ? 'block' : 'none';
      document.getElementById('menu-almacen').style.display = seccion === 'almacen' ? 'block' : 'none';
      document.getElementById('btn-rotiseria').classList.toggle('active', seccion === 'rotiseria');
      document.getElementById('btn-almacen').classList.toggle('active', seccion === 'almacen');
    }

    /* ---------- WhatsApp ---------- */
    function enviarPedido() {
      const name = document.getElementById('nombre').value.trim();
      const addr = document.getElementById('direccion').value.trim();
      const envio = document.querySelector('input[name=envio]:checked').value;

      if (!name) { showToast('Ingres√° tu nombre', 'error'); return; }
      if (countItems() === 0) { showToast('Seleccion√° al menos un producto', 'error'); return; }
      if (envio === 'envio' && !addr) { showToast('Ingres√° tu direcci√≥n para el env√≠o', 'error'); return; }

      let msg = `Hola, soy ${name}. Quiero hacer un pedido:\n`;
      Object.entries(cantidades).forEach(([id, qty]) => {
        if (qty > 0) {
          const span = document.getElementById(`cantidad-${id}`);
          if (!span) return;
          const row = span.closest('.producto');
          const namep = row.dataset.nombre;
          const price = parseInt(row.dataset.precio, 10);
          msg += `- ${namep} x${qty} - ${formatARS(price*qty)}\n`;
        }
      });

      msg += envio === 'envio'
        ? `Env√≠o a domicilio a: ${addr} (+${formatARS(1000)})\n`
        : 'Retiro en el local\n';

      msg += `Total: ${totalEl.textContent}`;
      const url = `https://wa.me/3415923882?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');
      showToast('Abriendo WhatsApp...', 'ok');
    }

    // Elevar FAB si el footer aparece (para no taparlo)
    const footerEl = document.getElementById('siteFooter');
    if ('IntersectionObserver' in window && footerEl) {
      const io = new IntersectionObserver(([entry])=>{
        fab.classList.toggle('raise', entry.isIntersecting);
      }, { rootMargin: '0px 0px -25% 0px', threshold: 0.01 }); // levantamos antes
      io.observe(footerEl);
    }
  </script>

  <div id="siteFooter" style="margin-top:2rem; text-align:center; font-size:0.9rem;">
    <p>¬øQuer√©s una web como esta para tu negocio?</p>
    <a href="mailto:ludmilasolutions2.0@gmail.com" style="background:#003366; color:#ffcc00; padding:0.6rem 1rem; border-radius:6px; text-decoration:none;">
      Escribime: ludmilasolutions2.0@gmail.com
    </a>
    <p style="margin-top:0.5rem;">Creado por <strong>Ludmila Mercado</strong></p>
  </div>
</body>
</html>
