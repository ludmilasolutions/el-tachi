<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rotiser√≠a El Tachi</title>
  <link rel="icon" href="logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --azul: #003366;
      --azul-2: #001122;
      --azul-3: #004080;
      --amarillo: #ffcc00;
      --gris-borde: #ccc;
      --bg: #f8f9fa;
      --text: #333;
      --card: #fff;
      --card-hover: #f1f1f1;
      --resumen-bg: #fff3cd;
      --resumen-borde: #ffeeba;
    }
    body.dark {
      --bg: #0f172a;
      --text: #e5e7eb;
      --card: #0b1223;
      --card-hover: #111a31;
      --gris-borde: #1f2a44;
      --resumen-bg: #17213b;
      --resumen-borde: #223055;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: 'Roboto', sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    header {
      position: relative;
      background: linear-gradient(90deg, var(--azul) 0%, var(--azul-2) 100%);
      color: #fff; text-align: center;
      padding: 2rem 1rem 1.2rem;
    }
    header img {
      max-height: 180px; margin-bottom: 1rem;
    }
    .theme-toggle {
      position: absolute; top: 12px; right: 12px;
      background: rgba(255,255,255,0.2); color: #fff;
      border: 1px solid rgba(255,255,255,0.5);
      padding: 0.5rem 0.9rem; border-radius: 999px;
      cursor: pointer; font-weight: 700;
      backdrop-filter: blur(2px);
    }
    main {
      max-width: 900px; margin: auto; padding: 1rem;
    }
    .tabs {
      display: flex; justify-content: center;
      gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;
    }
    .tabs button {
      padding: 0.8rem 1.8rem; font-size: 1.1rem;
      border: none; border-radius: 30px;
      background: var(--azul-3); color: var(--amarillo);
      font-weight: bold; cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
      transition: all 0.3s ease; border: 2px solid transparent;
    }
    .tabs button:hover { background: #0055aa; }
    .tabs button.active {
      background: var(--azul-2); border-color: var(--amarillo);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    details {
      background: var(--card);
      border: 1px solid var(--gris-borde);
      border-radius: 8px; margin-bottom: 1rem;
      overflow: hidden;
    }
    summary {
      background: var(--azul); color: var(--amarillo);
      padding: 1rem; font-weight: bold;
      font-size: 1.1rem; cursor: pointer;
      user-select: none; list-style: none;
    }
    .producto {
      display: flex; justify-content: space-between;
      align-items: center; gap: 0.75rem;
      padding: 0.5rem 1rem; border-top: 1px solid var(--gris-borde);
      background: var(--card);
      transition: background 0.2s;
    }
    .producto:hover { background: var(--card-hover); }
    .producto-info { max-width: 65%; }
    .producto h3 {
      margin: 0.2rem 0; color: #79a7ff; font-size: 1rem;
    }
    body.dark .producto h3 { color: #9dc0ff; }
    .producto p { margin: 0.1rem 0; font-size: 0.9rem; color: var(--text); }
    .contador {
      display: flex; align-items: center; gap: 0.5rem;
    }
    .contador button {
      background: var(--azul); color: var(--amarillo);
      border: none; padding: 0.3rem 0.6rem;
      font-weight: bold; font-size: 1.2rem;
      cursor: pointer; border-radius: 5px;
      transform-origin: center;
    }
    @keyframes pop { 0%,100%{transform:scale(1)}50%{transform:scale(1.2)} }
    .btn-pop { animation: pop 0.22s ease-out; }
    @keyframes flash { 0%,100%{box-shadow:0 0 0 rgba(255,204,0,0)}50%{box-shadow:0 0 0 4px rgba(255,204,0,0.35)} }
    .row-flash { animation: flash 0.35s ease-out; }
    #resumen {
      margin-top: 2rem; padding: 1rem;
      background: var(--resumen-bg);
      border: 1px solid var(--resumen-borde);
      border-radius: 8px;
    }
    #resumen button {
      background: var(--azul); color: var(--amarillo);
      border: none; padding: 0.8rem 1.2rem;
      margin-top: 1rem; font-weight: bold;
      font-size: 1rem; border-radius: 5px;
      cursor: pointer;
    }
    label { display: block; margin-top: 1rem; }
    .floating-counter {
      position: fixed; bottom: 16px; right: 16px;
      width: 56px; height: 56px; border-radius: 50%;
      background: var(--azul); color: var(--amarillo);
      display: flex; align-items: center; justify-content: center;
      font-weight: 800; cursor: pointer; z-index: 99;
      box-shadow: 0 8px 18px rgba(0,0,0,0.25);
      transition: transform 0.15s;
    }
    .floating-counter:hover { transform: translateY(-2px); }
    .floating-counter[hidden] { display: none; }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Rotiser√≠a El Tachi" />
    <h1>Rotiser√≠a El Tachi</h1>
    <p>¬°Hac√© tu pedido desde la web!</p>
    <button id="themeToggle" class="theme-toggle">üåì</button>
  </header>

  <main>
    <div class="tabs">
      <button id="btn-rotiseria" class="active" onclick="mostrar('rotiseria')">üçï Rotiser√≠a</button>
      <button id="btn-almacen" onclick="mostrar('almacen')">üõçÔ∏è Almac√©n</button>
    </div>

    <div id="menu-rotiseria"></div>
    <div id="menu-almacen" style="display:none"></div>

    <label><input type="radio" name="envio" value="retiro" checked> Retiro en el local</label>
    <label><input type="radio" name="envio" value="envio"> Env√≠o a domicilio (+$1000)</label>
    <label>Nombre: <input type="text" id="nombre" /></label>
    <label>Direcci√≥n: <input type="text" id="direccion" /></label>

    <div id="resumen">
      <h3>Resumen del pedido</h3>
      <ul id="lista"></ul>
      <p><strong>Total: $<span id="total">0</span></strong></p>
      <button onclick="enviarPedido()">Hacer pedido por WhatsApp</button>
    </div>
  </main>

  <!-- Contador flotante -->
  <div id="floatingCounter" class="floating-counter" hidden>0</div>

  <script>
    // Tema
    const themeToggle = document.getElementById('themeToggle');
    const current = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    if (current === 'dark') document.body.classList.add('dark');
    themeToggle.onclick = () => {
      document.body.classList.toggle('dark');
      const t = document.body.classList.contains('dark') ? 'dark' : 'light';
      localStorage.setItem('theme', t);
    };

    // Asset helper (Netlify / GH Pages)
    function asset(path) {
      if (location.hostname.endsWith('github.io')) {
        const repo = location.pathname.split('/').filter(Boolean)[0] || '';
        return `/${repo}/${path}`;
      }
      return `/${path}`;
    }

    // Normaliza CMS
    function normalizar(data) {
      if (data && Array.isArray(data.categorias)) {
        const o = {};
        data.categorias.forEach(c => { o[c.categoria] = c.productos || []; });
        return o;
      }
      return data || {};
    }

    const cantidades = {};
    const listaEl = document.getElementById('lista');
    const totalEl = document.getElementById('total');
    const floatEl = document.getElementById('floatingCounter');

    function renderProductos(id, data) {
      const cont = document.getElementById(id);
      cont.innerHTML = '';
      const obj = normalizar(data);
      Object.keys(obj).forEach(cat => {
        const detail = document.createElement('details');
        const sum = document.createElement('summary');
        sum.textContent = cat;
        detail.appendChild(sum);
        obj[cat].forEach((prod, i) => {
          const pid = `${id}-${cat}-${i}`;
          if (!(pid in cantidades)) cantidades[pid] = 0;
          const row = document.createElement('div');
          row.className = 'producto';
          row.innerHTML = `
            <div class="producto-info">
              <h3>${prod.nombre} - $${prod.precio}</h3>
              ${prod.desc ? `<p>${prod.desc}</p>` : ''}
            </div>
            <div class="contador">
              <button class="btn-minus" onclick="cambiar('${pid}', -1, this)">‚àí</button>
              <span id="cantidad-${pid}">0</span>
              <button class="btn-plus" onclick="cambiar('${pid}', 1, this)">+</button>
            </div>
          `;
          row.dataset.nombre = prod.nombre;
          row.dataset.precio = prod.precio;
          detail.appendChild(row);
        });
        cont.appendChild(detail);
      });
    }

    function cargar() {
      fetch(asset('data/productos-rotiseria.json'))
        .then(r => r.json()).then(d => renderProductos('menu-rotiseria', d))
        .catch(e => console.error(e));
      fetch(asset('data/productos-almacen.json'))
        .then(r => r.json()).then(d => renderProductos('menu-almacen', d))
        .catch(e => console.error(e));
    }
    cargar();

    function cambiar(id, delta, btn) {
      cantidades[id] = Math.max(0, (cantidades[id] || 0) + delta);
      document.getElementById(`cantidad-${id}`).textContent = cantidades[id];
      // animaciones
      if (delta > 0) {
        btn.classList.add('btn-pop');
        btn.addEventListener('animationend', ()=> btn.classList.remove('btn-pop'), { once: true });
        const row = btn.closest('.producto');
        row.classList.add('row-flash');
        row.addEventListener('animationend', ()=> row.classList.remove('row-flash'), { once: true });
      }
      actualizar();
    }

    function actualizar() {
      listaEl.innerHTML = '';
      let total = 0, count = 0;
      Object.entries(cantidades).forEach(([id, qty]) => {
        if (qty > 0) {
          const span = document.getElementById(`cantidad-${id}`);
          if (!span) return;
          const row = span.closest('.producto');
          const name = row.dataset.nombre;
          const price = parseInt(row.dataset.precio, 10);
          const li = document.createElement('li');
          li.textContent = `${name} x${qty} - $${price * qty}`;
          listaEl.appendChild(li);
          total += price * qty;
          count += qty;
        }
      });
      const envio = document.querySelector('input[name=envio]:checked').value;
      if (envio === 'envio') total += 1000;
      totalEl.textContent = total;
      // floating count
      if (count > 0) {
        floatEl.textContent = count;
        floatEl.hidden = false;
      } else {
        floatEl.hidden = true;
      }
    }
    document.querySelectorAll('input[name=envio]').forEach(r => r.addEventListener('change', actualizar));

    floatEl.onclick = () => {
      document.getElementById('resumen').scrollIntoView({ behavior: 'smooth' });
    };

    function enviarPedido() {
      const name = document.getElementById('nombre').value.trim();
      const addr = document.getElementById('direccion').value.trim();
      const envio = document.querySelector('input[name=envio]:checked').value;
      if (!name) return alert('Por favor, ingres√° tu nombre.');
      if (envio === 'envio' && !addr) return alert('Por favor, ingres√° tu direcci√≥n.');
      let msg = `Hola, soy ${name}. Quiero hacer un pedido:\n`;
      let ok = false;
      Object.entries(cantidades).forEach(([id, qty]) => {
        if (qty > 0) {
          const span = document.getElementById(`cantidad-${id}`);
          const row = span.closest('.producto');
          const namep = row.dataset.nombre;
          const price = parseInt(row.dataset.precio, 10);
          msg += `- ${namep} x${qty} - $${price * qty}\n`;
          ok = true;
        }
      });
      if (!ok) return alert('Seleccion√° al menos un producto.');
      msg += envio === 'envio'
        ? `Env√≠o a domicilio a: ${addr} (+$1000)\n`
        : 'Retiro en el local\n';
      msg += `Total: $${totalEl.textContent}`;
      window.open(`https://wa.me/3415923882?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function mostrar(sec) {
      document.getElementById('menu-rotiseria').style.display = sec === 'rotiseria' ? 'block' : 'none';
      document.getElementById('menu-almacen').style.display = sec === 'almacen' ? 'block' : 'none';
      document.getElementById('btn-rotiseria').classList.toggle('active', sec === 'rotiseria');
      document.getElementById('btn-almacen').classList.toggle('active', sec === 'almacen');
    }
  </script>
</body>
</html>
